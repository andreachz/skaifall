import{z as s,w as Z,d as Q,a as X,u as Y,L as w,F as ee}from"./useAppNameEnum-B_RCZZaG.js";import{r as O,u as se,j as e,a as oe,d as h}from"./index-DjeUAv9f.js";import{M as m,c as re}from"./index-npON1Cka.js";import{A as te,T as g}from"./AuthStepLayout-DRZ_4X3y.js";import{C as ie}from"./ContinueButton-ClfUcDvA.js";import{F as ne}from"./FieldGrouping-BFjljUyA.js";import{u as ae,s as x,L as de}from"./auth.module-DCdjcwGA.js";import{N as b}from"./NamedDivider-BZV0W2fV.js";import{P as le}from"./PasswordInput-DvjzGPfI.js";import{P as ce}from"./PendingFormDisabler-ByemvU9-.js";import{R as me}from"./ReadonlyUsernameInput-CsuiXoZW.js";import{S as pe}from"./SocialLoginButton-x1fn0BlU.js";import{S as ue}from"./StickyForm-DCY7ld8k.js";import{c as ge}from"./useUsernameKind-DUS4mBhw.js";import{u as he}from"./loginOptions-CfVsRop8.js";import{u as fe}from"./useWaitlistRedirectUrl-BvXInaEb.js";import{L as a}from"./loginOption-DXGQrmx0.js";import{U as we}from"./username-DImii0_h.js";import{R as L}from"./routeId-Bcr4Hy4z.js";import{r as A,g as C,a as N}from"./client-auth-session-dSv1Q7Dl.js";import{u as xe,c as je,e as Pe,i as Se}from"./schema-validation-zHt9rOTF.js";import{g as M,a as E}from"./sentinel.client-DEt-Ymep.js";import{u as k}from"./use-event-loggers-BYzAYOjx.js";import{w as F}from"./utils-BGG_ggsw.js";import{p as P}from"./parse-Cb61DG-V.js";import{u as _e,a as R,g as ye}from"./helpers-DNc4uupA.js";import"./Button-CCHVtoRV.js";import"./noop-DX6rZLP_.js";import"./OverlayArrow-lS84iosS.js";import"./FormField-DK50dxQ6.js";import"./index-g2bMlRvq.js";import"./UnstyledButton.module-B7YD8bFL.js";import"./context-CWgrrSUa.js";import"./TextInput-BR8pOaYj.js";import"./isNumber-CpuftVQ5.js";import"./_baseGetTag-DBIYhhxi.js";import"./isObjectLike-nLWjQ9zq.js";import"./Logo-CFlQEucm.js";import"./openai-logo-Cr44hqyW.js";import"./useTypedSearchParams-BhKJnsRl.js";import"./useTypedDynamicConfig-CGyPrPvB.js";import"./index-VWaDGczM.js";import"./_MapCache-TO9IM_u8.js";import"./isArray-Dxzbedgu.js";import"./_overArg-BLH_OBOE.js";import"./datadog.client-CkkgoxcC.js";import"./preload-helper-BPn92lI4.js";const Ie="_forgotPassword_a7dpu_1",ve={forgotPassword:Ie},D=s.object({username:s.string(),"current-password":s.string()}),U=je(Pe(["current-password"],Se,h({id:"logIn.passwordRequired",defaultMessage:"Password is required.",description:"Error message shown when the password field is empty on the create account page"}))),Oe=s.object({status:s.literal(401),json:s.object({error:s.object({code:s.literal("invalid_username_or_password")})})}),be=s.object({status:s.literal(401),json:s.object({error:s.object({code:s.literal("password_reset_required")})})}),Ae=s.object({intent:a.exclude([a.enum.email,a.enum.phone_number])}),G={[a.enum.google]:"google-oauth2",[a.enum.microsoft]:"windowslive",[a.enum.apple]:"apple"};async function ys({request:r}){const t=await r.formData(),n=P(t,{schema:Ae});if(n.status==="success"){const l=await F(M("authorize_continue"),5e3);return A(r,"https://auth.openai.com/api/accounts/authorize/continue",{method:"POST",headers:{"Content-Type":"application/json",...E(l)},body:JSON.stringify({connection:G[n.value.intent],from_password_screen:!0})})}const o=P(t,{schema:D,formatError:U});if(o.status!=="success")throw Q("Unknown error",{status:400});const d=await F(M("password_verify"),5e3);return A(r,"https://auth.openai.com/api/accounts/password/verify",{method:"POST",headers:{"Content-Type":"application/json",...E(d)},body:JSON.stringify({password:o.value["current-password"],username:o.value.username})},{intercept:l=>{if(Oe.safeParse(l).success){const{username:c}=C(N(r));return(c==null?void 0:c.kind)==we.enum.phone_number?o.reply({fieldErrors:{"current-password":[{message:h({id:"logInPassword.incorrectPhonePassword",defaultMessage:"Incorrect phone number or password",description:"Error message shown when a user tries to enter an incorrect password for phone-password login."})}]}}):o.reply({fieldErrors:{"current-password":[{message:h({id:"logInPassword.incorrectEmailPassword",defaultMessage:"Incorrect email address or password",description:"Error message shown when a user tries to enter an incorrect password for email-password login."})}]}})}if(be.safeParse(l).success)return o.reply({fieldErrors:{"current-password":[{message:h({id:"logInPassword.passwordResetRequired",defaultMessage:"For improved account protection, please change your password and then log in again",description:"Error message shown when the user must reset their password before logging in."})}]}})}})}async function Is({request:r}){const{username:t,login_start_url:n,original_screen_hint:o}=C(N(r));if(!t)throw new Response("Missing already entered username",{status:400,statusText:"Missing already entered username"});return{username:t,login_start_url:n,original_screen_hint:o}}const vs=Z(function(){const t=O.useId(),n=fe(),o=X(),{username:d,login_start_url:l,original_screen_hint:c}=Y(),p=se(),{logSwitchToSignUp:z}=k(),[S,f]=_e({lastResult:o,shouldValidate:"onSubmit",shouldRevalidate:"onInput",onValidate:({formData:i})=>P(i,{schema:D,formatError:U})}),W=xe(S),_=c==="login_or_signup",{type:Me,...q}=R(f["current-password"],{type:"password"}),u=O.useId(),{googleOption:K,microsoftOption:$,appleOption:B}=he({loginStrategy:"existing_user"}),y=!!(K||$||B),{isSocialAuthPrioritized:I,isInAnySimplifiedAuthScreen:H,socialButtonAlignment:V,isFlattenedLoginOptionsAtTop:J}=ae(),v=e.jsx(de,{loginStrategy:"existing_user",loginOptionAlignment:V,google:({tempDisabled:i})=>e.jsx(j,{provider:a.enum.google,socialsFormId:u,formFieldName:"intent",tempDisabled:i}),microsoft:({tempDisabled:i})=>e.jsx(j,{provider:a.enum.microsoft,socialsFormId:u,formFieldName:"intent",tempDisabled:i}),apple:({tempDisabled:i})=>e.jsx(j,{provider:a.enum.apple,socialsFormId:u,formFieldName:"intent",tempDisabled:i}),email:()=>null,phone_number:()=>null});return e.jsxs(e.Fragment,{children:[e.jsx(te,{title:p.formatMessage({id:"logInPassword.title",defaultMessage:"Enter your password",description:"Title for the log in page where users can enter their password"}),titleId:t,children:e.jsx(ce,{children:e.jsx(ue,{method:"POST","aria-labelledby":t,...ye(S),autoComplete:"on",topCtas:I&&y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:x.topCtas,children:v}),J&&e.jsx("div",{className:x.fadedText,children:e.jsx(b,{children:e.jsx(m,{id:"logIn.orDivider",defaultMessage:"OR",description:"Divider text between sign in with email and other identity providers like Google or Microsoft"})})})]}):null,fields:e.jsxs(e.Fragment,{children:[e.jsx("input",{...R(f.username,{type:"hidden"}),value:d.value}),e.jsxs(ne,{children:[e.jsx(me,{username:d,endDecoration:e.jsx(g,{children:e.jsx(w,{to:{pathname:_?"/log-in-or-create-account":l||"/log-in",search:`?${ge(d.kind)}`},"aria-label":p.formatMessage(d.kind==="email"?T.editEmailAria:T.editPhoneAria),children:e.jsx(m,{id:"logInPassword.editEmail",defaultMessage:"Edit",description:"A link to edit the email address"})})})}),e.jsx(le,{label:p.formatMessage({id:"logIn.password",defaultMessage:"Password",description:"Label for the password input field"}),autoComplete:"current-password",autoFocus:!0,...q,errors:W(f["current-password"])}),e.jsx(g,{className:ve.forgotPassword,size:"small",children:e.jsx(w,{to:"/reset-password",children:e.jsx(m,{id:"logInPassword.forgotPassword",defaultMessage:"Forgot password?",description:"Text prompting users who forgot their password to reset it."})})})]})]}),ctas:e.jsxs(e.Fragment,{children:[e.jsx(ie,{}),!_&&e.jsx(g,{children:e.jsx(m,{id:"logIn.dontHaveAnAccount",defaultMessage:"Don't have an account? <signUp>Sign up</signUp>",description:"Text prompting users who don't have an account to sign up instead. Contains a link to the sign up page.",values:{signUp:i=>n?e.jsx(g,{children:e.jsx("a",{href:n,children:i})}):e.jsx(w,{to:"/create-account",onClick:()=>{z({showedInvalidEmailError:!1,fromRoute:L.LOG_IN_PASSWORD})},children:i})}})}),!I&&y&&e.jsxs(e.Fragment,{children:[e.jsx("div",{className:re({[x.fadedText]:H}),children:e.jsx(b,{children:e.jsx(m,{id:"logIn.orDivider",defaultMessage:"OR",description:"Divider text between sign in with email and other identity providers like Google or Microsoft"})})}),v]})]})})})}),e.jsx(ee,{id:u,method:"POST",hidden:!0})]})}),T=oe({editEmailAria:{id:"createAccountPassword.editEmailAria",defaultMessage:"Edit email",description:"A link to edit the email address"},editPhoneAria:{id:"createAccountPassword.editPhoneAria",defaultMessage:"Edit phone number",description:"A link to edit the phone number"}}),j=({provider:r,socialsFormId:t,formFieldName:n,tempDisabled:o})=>{const{logSocialSso:d}=k();return e.jsx(pe,{variant:"outline",form:t,name:n,value:r,provider:r,tempDisabled:o,onClick:()=>{d({connection:G[r],fromRoute:L.LOG_IN_PASSWORD})}})};export{ys as clientAction,Is as clientLoader,vs as default};
//# sourceMappingURL=route-D5hwh-kI.js.map
